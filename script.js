// --- Page 6 Threats Section ---
document.addEventListener('DOMContentLoaded', function() {
  const threatContent = {
    overfishing: `

        <img src="images/threat/overfishing.jpg" alt="Overfishing">
        <p>
        Decades of overfishing along with destructive practices like dynamite fishing, bottom trawling, and cyanide fishing have wreaked havoc in the Philippine Sea.

          <br><br><b>Dynamite fishing</b> – explosives are recklessly detonated underwater, not only killing fishes indiscriminately of size, but also shattering coral reef formations which takes centuries to grow.
        
        
          <br><br><b>Cyanide fishing</b> – originating from the Philippines, this process is used to capture live fish for market or aquarium purposes. It stuns fishes by putting sodium cyanide mixture into the water. It is non-lethal to fishes but cyanide kills coral polyps and algae.
        
        
          <br><br><b>Trawling</b> – bottom trawling is done by dragging huge nets across seafloors (commonly targeting prawn and shrimp). This however, disrupts other species it comes in contact with (bycatch), as well as damaging corals.  In Samar Sea, driven by the basic need to eat and earn a living, many fishers in the area practice this method. 
        
          
        <br><br>Yet despite the overall negative effects, such practices are preferred as it supposedly generates more profit. An analysis by the University of British Columbia found that destructive fishing methods have been liberally used in the Philippines since the 1960s, with peaks in the 70s and 80s when national fishing policies shortsightedly encouraged higher yield from fish stocks with no regard for collateral side-effects. Although the authorities issued a ban in the late 90s, those fishing methods continue to be commonly practiced until this day.
        <br><br><a href="https://earth.org/marine-biodiversity-in-the-philippines-faces-decimation/" target="_blank">
          [1] Garry, H. (2021, March 19). The Philippines’ marine biodiversity faces decimation. Earth.Org.
        </a><br>
        <a href="https://ph.oceana.org/wp-content/uploads/sites/16/policy_brief_on_bottom_trawling_in_the_philippines.pdf" target="_blank">
          [2] Policy Brief: Bottom Trawling in the Philippines (n.d.). Oceana
        </a><br>
        <a href="https://wwf.panda.org/wwf_news/?5563/Cyanide-an-easy-but-deadly-way-to-catch-fish" target="_blank">
          [3] Cyanide: an easy but deadly way to catch fish (n.d.). WWF.
        </a>
        </p>

      </div>
    `,
    pollution: `
      <img src="images/threat/pollution.jpg" alt="Pollution">
      <p>
        Not only the well-being of ecosystems depends on the state of water, but human civilization itself largely depends on the world's ccean: it affects the weather and climate of the entire planet. The development of civilization has led to increased pollution of the oceans. The situation began to deteriorate from about the middle of the twentieth century, which was associated with the development of the chemical and oil refining industries.
        <br><br>
        <b>The Philippines was the world's biggest plastic ocean polluter in 2019</b>.
        The country was responsible for 36.38% of global oceanic plastic waste, far more than the second-largest plastic polluter, India, which in the same year accounted for about 12.92% of the total. Root cause of this is said to be our reliance in single-use sachet. The wastes comes from small water bodies then making their way to the sea. The plastics are harmful for marine animals as they can accidently consume it. In turn, this also presents risks on humans that eat fish contaminated with microplastics. Research in Pasig and Marikina Rivers found microplastics in tilapia and catfish. Fragments of polypropylene and polyethylene (from single-use plastics) were most common, absorbed via gills or ingestion.

        <br><br><a href="https://www.sciencedirect.com/science/article/abs/pii/S0025326X23000048" target="_blank">
          [1] Espiritu, E., et. al. (2023). Microplastics contamination in the fishes of selected sites in Pasig River and Marikina River in the Philippines. Marine Pollution Bulletin, 187, 114573.
        </a>
        
        <br>
        <a href="https://earth.org/philippines-plastic/" target="_blank">
          [2] Ramos, D. (2024). Plastic pollution in the Philippines: causes and solutions. Earth.Org.
        </a>
      </p>
    `,
    climate: `
      <img src="images/threat/climate_change.jpg" alt="Climate Change">
      <p><b>Ocean acidification</b> is a problem brought by climate change that impacts the marine ecosystem. It happens when the pH level of seawater decreases. This is caused by the ocean absorbing excess carbon dioxide from the atmosphere, which increases as humans contribute more carbon to the atmosphere. Ocean acifidication cause changes in the ocean's natural chemistry, and such changes will have severe impacts on marine ecosystem. Some examples are are listed below. 

      <br><br><b>Whales</b> may suffer from starvation and other diseases due to ocean acidification’s effects on their food supply. And thus distrupting their role in the food chain.
      
      <br><br><b>Salmon</b> and other fish species feel the impact of ocean acidification. As acidity levels rise in the ocean, chemical imbalances are created within their bodies, which are normally balanced with the pH of the surrounding water. 

      <br><br><b>Clams and other shell-forming marine species</b> are particularly vulnerable to ocean acidification. As rising acidity in seawater reduces the number of carbonate ions, shell-forming organisms like clams don’t have enough carbonate to build their shells.  Whereas, <b>giant clam ecotoursim is prevalent in the Philippines, particularly Samal Islands.</b> With higher mortality rates, smaller sizes, and poor clam quality, the clam aquaculture and tourism sector as a whole may suffer due to ocean acidification. These negative consequences of ocean acidification on clams may harm people who rely on clams for a living, as well as the local economy that majorly depends on the clam industry. 

      <br><br><a href="https://ocean-acidification.com/page/2/" target=_blank>Ocean acidification (2022). Team Writer</a>
      </p>
    `,
    policy: `
      <img src="images/threat/lax_policies.jpg" alt="Weak Policy Enforcement">
<p>There are about <b>1,800 Marine Protected Areas (MPA)</b> in the Philippines, mostly designated by local government units while some are legislated by Congress. However, not all MPAs are managed properly. A 2008 study revealed that <b>only 10 to 15% of the established protected areas in the Philippines are managed effectively</b>. More work is also needed to protect as many areas as possible. Furthermore, a 2010 study found that the <b>distribution of MPAs does not accurately represent important biodiversity zones, with only 2.7 to 3.4% of reefs considered under protection.</b>

<br><br>A 2022 update from the Biodiversity Management Bureau of the Department of Environment and Natural Resources (DENR), however, reported that 65,267 hectares of coral reef areas​​—or <b>only 8.2% of the total 796,000 hectares—are within protected areas</b> under the National Integrated Protected Areas System (NIPAS).

<br><br>With the necessary legislation in place, consistent and efficient implementation of these measures is crucial, along with the active involvement of local communities. There has been some improvement on protecting marine life in the Philippines such as the <b>Bantay Dagat</b> which is community-based volunteering across the country where people patrol marine sanctuaries. They use lights, binoculars and megaphones to warn fishers away and have the power to detain anyone found illegally fishing and hand them over to the police. Ultimately, these coastal ecosystems not only serve marine life, but are also vital in our collective fight against the climate crisis.

<br><br><a href="https://climatetracker.asia/challenges-in-conserving-philippine-marine-ecosystems" target=_blank>[1] Tan, N. (2024). Challenges in conserving Philippine marine ecosystems. Climate Tracker Asia.</a><br>
<a href="https://edition.cnn.com/interactive/2025/06/climate/philippines-fishing-industry-storms-rising-seas-cnnphotos/" target=_blank>[2] Threatened by supercharged storms and rising oceans, Filipino fishing communities are fighting for their lives. (n.d.). CNN.</a>
</p>
    `,

   invasive: `
      <img src="images/threat/invasive.jpg" alt="Invasive Species">
<p>Over the last decade, fisherfolk operating in freshwater lakes and rivers have noticed a shift in the contents of their catch whereas <b>escaped invasive species dominate the native biodiversity</b> through competition, predation, and disease transimission. Native fish like biya (gobies), ayungin (silver perch), martiniko (climbing perch), and ulang (freshwater shrimp) have grown fewer. Meanwhile, species foreign to the Philippines such as knifefish from Indochina, blackchin tilapia from Africa, janitor fish from the Americas, and cream dory from other parts of Asia, have multiplied in inland waters. 

<br><br>Only kanduli have decent numbers among the native species that were prevalent to our waters before. It is said that <b>the reason for the decrease in our native fish is because foreign fishes are eating them, decimating their population over time.</b> These foreign usually "invades" other native species' habitats when it rains where water levels are elevated. In 2011, two years after Typhoon Ondoy, fisherfolk in the Laguna Lake area reported an alarming presence of the ornamental knifefish in the lake, which was traced back to their possible escape from aquaculture ponds during the typhoon. BFAR, after conducting surveys, declared it an infestation of invasive alien species (IAS) in the lake.  

<br><br><a href="https://www.bworldonline.com/agribusiness/2021/09/20/397595/phl-waters-being-taken-over-by-invasive-fish/" target=_blank>Lacsamana, B. (2021). PHL waters being taken over by invasive fish. BusinessWorld Online. </a>
</p>
    `
  };
  const threatBox = document.getElementById('threatInfoBox');
  const threatTopics = document.querySelectorAll('.page-6 .big-text');
  const threatKeys = ['overfishing', 'pollution', 'climate', 'invasive', 'policy'];
  let threatCurrentIndex = 0;

  function clearActiveThreat() {
    threatTopics.forEach(el => el.classList.remove('threat-active'));
  }
  function showThreatInfo(threat) {
    if (!threatBox) return;
    threatBox.innerHTML = threatContent[threat];
    threatBox.style.display = 'block';
    clearActiveThreat();
    const el = document.querySelector(`.page-6 .text-${threat}`);
    if (el) el.classList.add('threat-active');
    threatCurrentIndex = threatKeys.indexOf(threat);
    // Reset scrollbar to top when topic changes
    threatBox.scrollTop = 0;
  }
  threatTopics.forEach(el => {
    el.addEventListener('mouseenter', () => {
      const threat = el.getAttribute('data-threat');
      showThreatInfo(threat);
    });
    // No mouseleave handler: last hovered stays active
  });
  // Show the first threat on load
  showThreatInfo(threatKeys[0]);
});

// --- Card click-to-link for Page 5 ---
document.addEventListener('DOMContentLoaded', function() {
  const cardLinks = [
    'https://www.fao.org/philippines/news/detail/es/c/435529/',
    'https://www.researchgate.net/publication/318451686_Initial_Findings_of_the_Nationwide_Assessment_of_Philippine_Coral_Reefs_Philippine_Journal_of_Science_1462177-185', // Licuanan et al. (2017) - use a journal link or placeholder
    'https://oneocean.org/flash/the_philippine_seas.html',
    'https://www.researchgate.net/publication/280940198_Detection_of_ciguatera_fish_poisoning_in_the_Philippines',
    'https://theguidon.com/2023/09/a-sea-of-food-persisting-problems-in-the-fishing-sector/',
    'https://iwlearn.net/files/pdfs/Ahmed%20et%20al%202007_Coral%20reefs%20Bolinao.pdf',
    'https://www.greeneconomycoalition.org/news-and-resources/philippine-mangroves-fight-floods#:~:text=Troublingly%2C%20mangroves%20in%20the%20Philippines,well%20as%20providing%20jobs%20and',
    'https://oneocean.org/flash/the_philippine_seas.html'
  ];
  const cards = document.querySelectorAll('.page-5 .card');
  cards.forEach((card, i) => {
    card.addEventListener('click', function(e) {
      // Only open if a link is defined
      if (cardLinks[i]) {
        window.open(cardLinks[i], '_blank');
      }
    });
    card.style.cursor = 'pointer';
  });
});
const infoContent = {
  reefs: `
    <p>
      Philippines is considered as the <b>“center of the center”</b> when it comes to marine biodiversity. Due to the large number of the corals in the area, Philippines, Malaysia, Indonesia, Timor Leste, Papua New Guinea and Solomon Island are located in the region called <b>“Coral Triangle”</b> where 76% (605) of the world’s coral species (798) are found, the highest coral diversity in the world.
      <br><br><img src="images/fact-coral_triangle.jpg">

      If the region is the center of global marine biodiversity, the Philippines is the “center of the center.” Its marine resources are made up not just of coral reefs but “seagrass beds, mangrove and beach forests, fisheries, invertebrates, seaweeds, marine mammals and many others”
      The Philippines has the second highest seagrass diversity in the world, second only to Australia. 
      <br><br>Due to the country's marine biodiversity richness, conservationists have advocated its becoming a special focus of marine conservation efforts.

      <br><br><a href='https://www.undp.org/philippines/publications/4th-philippine-national-report-convention-biological-diversity' target=_black>The 4th Philippine National Report to the Convention on Biological Diversity. (n.d.).UNDP.</a>
    </p>
  `,
  resources: `
    <p>

    \u2022 <b>Ensures food security:</b> marine biodiversity supports up to 25% proportion of the country’s marine fisheries production.
    <br><br>\u2022 <b>The Philippines</b> has 500 species of corals and 1,763 reef associated species. In which our nation's reef economic value is estimated to be around 202 billion pesos per year.
    <br><br>\u2022 <b>Coral reefs boost eco-tourism</b>: 3rd largest reef area (~2.5 million hectares) and most diverse coral reef in the world where 1m² of healthy reefs = 1-5kg of white sand/year.
    <br><br>\u2022 <b>Medical resources:</b> marine organisms like cone snails produce compounds used in medicines (e.g., ziconotide, a painkiller 1,000x stronger than morphine).

    <br><br><br><br><a href='https://www.sciencedirect.com/science/article/abs/pii/S0921800917300812' target=_black>Tamayo N., et al. (2018). National Estimates of Values of Philippine Reefs' Ecosystem Service. Ecological Economics. Volume 146.</a>
    </p>
  `,

  resilience: `
    <p>
      Coral reefs and other coastal ecosystems such as seagrasses and mangroves are widely recognized to provide <b>protection against the devastating effects of strong waves</b> associated with tsunamis and storms. Meta-analyses reveal that coral reefs provide substantial protection against natural hazards by <b>reducing wave energy by an average of 97%</b> — reef crests alone dissipate most of this energy (86%).

      <br><br><img src="images/fact-coastal_protection2.jpg">
      <img src="images/fact-coastal_protection.jpg">

      <a href='https://doi.org/10.1038/ncomms4794' target=_black>Ferrario, F., et al. (2014). The effectiveness of coral reefs for coastal hazard risk reduction and adaptation. Nature Communications, 5(1). </a>
    </p>
  `,
};

const infoBox = document.getElementById('infoBox');
const topics = document.querySelectorAll('.text-reefs, .text-resources, .text-resilience');
const topicKeys = ['reefs', 'resources', 'resilience'];
let currentIndex = 0;
let isHovering = false;

// Helper to remove .topic-active from all topics
function clearActiveTopic() {
  topics.forEach(el => el.classList.remove('topic-active'));
}

// Show info for a given topic key and animate the topic
function showInfo(topic) {
  infoBox.innerHTML = infoContent[topic];
  infoBox.style.display = 'block';
  clearActiveTopic();
  // Add .topic-active to the relevant topic
  document.querySelector(`.text-${topic}`).classList.add('topic-active');
  // Reset scrollbar to top when topic changes
  infoBox.scrollTop = 0;
}

// Hide info box and remove animation
// function hideInfo() {
// //   infoBox.style.display = 'none';
//   clearActiveTopic();
// }

// Add hover listeners
topics.forEach(el => {
  el.addEventListener('mouseenter', () => {
    isHovering = true;
    const topic = el.getAttribute('data-topic');
    showInfo(topic);
    // Update currentIndex to the hovered topic's index
    currentIndex = topicKeys.indexOf(topic);
  });
  el.addEventListener('mouseleave', () => {
    isHovering = false;
    hideInfo();
  });
});

// Show the first topic quickly (e.g., after 1 second)
showInfo(topicKeys[currentIndex]);
currentIndex = (currentIndex + 1) % topicKeys.length;

setTimeout(() => {
  setInterval(() => {
    if (!isHovering) {
      showInfo(topicKeys[currentIndex]);
      currentIndex = (currentIndex + 1) % topicKeys.length;
    }
  }, 15000); // 15 seconds
}, 1000); // 1 second delay for the first topic (adjust as needed)


// Page 4

let currentSlideIndex = 0;
const slides = document.querySelectorAll('.slide');
const indicators = document.querySelectorAll('.indicator');
const contents = document.querySelectorAll('.content');
const totalSlides = slides.length;
const page4 = document.querySelector('.page-4');

const bgClasses = ['bg1', 'bg2', 'bg3', 'bg4'];

function updatePage4Bg(index) {
  if (!page4) return;
  bgClasses.forEach(cls => page4.classList.remove(cls));
  page4.classList.add(bgClasses[index]);
}

function showSlide(index) {
  // Hide all slides and contents
  slides.forEach(slide => slide.classList.remove('active'));
  indicators.forEach(indicator => indicator.classList.remove('active'));
  contents.forEach(content => content.classList.remove('active'));
  // Show current slide and content
  slides[index].classList.add('active');
  indicators[index].classList.add('active');
  contents[index].classList.add('active');
  updatePage4Bg(index);
  // Reset info-panel scrollbar to top
  const infoPanel = document.querySelector('.info-panel');
  if (infoPanel) infoPanel.scrollTop = 0;
}

function changeSlide(direction) {
  currentSlideIndex += direction;
  if (currentSlideIndex >= totalSlides) {
    currentSlideIndex = 0;
  } else if (currentSlideIndex < 0) {
    currentSlideIndex = totalSlides - 1;
  }
  showSlide(currentSlideIndex);
}

function currentSlide(index) {
  currentSlideIndex = index - 1;
  showSlide(currentSlideIndex);
}

// DISABLED: Auto-advance slides every 20 seconds
// setInterval(() => {
//   changeSlide(1);
// }, 3000);

// Initialize
showSlide(0);